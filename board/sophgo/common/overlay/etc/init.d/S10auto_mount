#!/bin/sh
${CVI_SHOPTS}
# This file is automatically generated by create_automount.py
# Please do not modify this file manually!
case "$1" in
start)
ENV_DLFLAG=`fw_printenv dl_flag 2>/dev/null |awk -F= '{print $2}'`
printf "Mounting CFG partition\n"
e2fsck -y /dev/mmcblk0p6
mount -t ext4 -o sync /dev/mmcblk0p6 /mnt/cfg
if [ $? != 0  ]; then
echo 'Mount CFG failed, Try formatting and remounting'
mke2fs -T ext4 /dev/mmcblk0p6
mount -t ext4 -o sync /dev/mmcblk0p6 /mnt/cfg
resize2fs /dev/mmcblk0p6
elif [ $DL_FLAG'h' == '0x50524F47''h' ] || [ -z $ENV_DLFLAG ] || [ $ENV_DLFLAG == 'prog' ]; then
resize2fs /dev/mmcblk0p6
fi
ENV_DLFLAG=`fw_printenv dl_flag 2>/dev/null |awk -F= '{print $2}'`
printf "Mounting DATA partition\n"
if [ $DL_FLAG'h' == '0x50524F47''h' ] || [ -z $ENV_DLFLAG ] || [ $ENV_DLFLAG == 'prog' ]; then
printf "OK\nFix\n" | parted ---pretend-input-tty /dev/mmcblk0 print
parted -s /dev/mmcblk0 resizepart 7 100% 
fi
e2fsck -y /dev/mmcblk0p7
mount -t ext4 -o sync /dev/mmcblk0p7 /mnt/data
if [ $? != 0  ]; then
echo 'Mount DATA failed, Try formatting and remounting'
mke2fs -T ext4 /dev/mmcblk0p7
mount -t ext4 -o sync /dev/mmcblk0p7 /mnt/data
resize2fs /dev/mmcblk0p7
elif [ $DL_FLAG'h' == '0x50524F47''h' ] || [ -z $ENV_DLFLAG ] || [ $ENV_DLFLAG == 'prog' ]; then
resize2fs /dev/mmcblk0p7
fi
fw_setenv dl_flag done
;;
esac
