#!/bin/sh

if [ "$1" = "start" ]
then
	. /etc/profile
	printf "load kernel module: "
	depmod -a
	ls /etc/modules-load.d/*.conf | sort | while read conf
	do
		cat $conf | while read line
		do
			if [ -e /mnt/system/ko/modules.dep ]
			then
				modprobe $line
			else
				if [ -e /mnt/system/ko/${line}.ko ]
				then
					insmod /mnt/system/ko/${line}.ko
				else
					insmod /mnt/system/ko/3rd/${line}.ko
				fi
			fi
		done
	done
	echo "OK"
	exit 0
fi
