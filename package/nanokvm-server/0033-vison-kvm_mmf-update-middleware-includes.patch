From 3fd61f7a542169330cba6c090792e2b503348c1a Mon Sep 17 00:00:00 2001
From: scpcom <scpcom@gmx.de>
Date: Wed, 19 Feb 2025 19:20:57 +0100
Subject: [PATCH] vison: kvm_mmf: update middleware includes

---
 vision/components/kvm_mmf/CMakeLists.txt | 37 ++++--------------------
 1 file changed, 5 insertions(+), 32 deletions(-)

diff --git a/vision/components/kvm_mmf/CMakeLists.txt b/vision/components/kvm_mmf/CMakeLists.txt
index a0e5813..db3984c 100644
--- a/vision/components/kvm_mmf/CMakeLists.txt
+++ b/vision/components/kvm_mmf/CMakeLists.txt
@@ -5,7 +5,8 @@ list(APPEND ADD_INCLUDE "include")
 # sophgo-middleware
 set(middleware_version_str "${CONFIG_SOPHGO_MIDDLEWARE_VERSION_MAJOR}.${CONFIG_SOPHGO_MIDDLEWARE_VERSION_MINOR}.${CONFIG_SOPHGO_MIDDLEWARE_VERSION_PATCH}")
 set(middleware_unzip_path "${DL_EXTRACTED_PATH}/sophgo-middleware")
-set(middleware_src_path "${middleware_unzip_path}/sophgo-middleware-${middleware_version_str}")
+set(middleware_src_path "${CMAKE_CURRENT_SOURCE_DIR}/../3rd_party/sophgo-middleware/sophgo-middleware")
+list(APPEND ADD_DEFINITIONS -D__CV181X__)
 
 
 set(source_dir "src")
@@ -16,6 +17,7 @@ set(middleware_include_dir .
     ${middleware_src_path}/v2/component/panel/${CONFIG_SOPHGO_MIDDLEWARE_CHIP}
     ${middleware_src_path}/v2/include
     ${middleware_src_path}/v2/include/isp/${CONFIG_SOPHGO_MIDDLEWARE_CHIP}
+    ${middleware_src_path}/v2/component/isp/common
     ${middleware_src_path}/v2/sample/common
     ${middleware_src_path}/v2/uapi
     ${middleware_src_path}/v2/3rdparty/inih
@@ -25,6 +27,7 @@ list(APPEND ADD_INCLUDE ${middleware_include_dir})
 set_property(SOURCE ${middleware_include_dir} PROPERTY GENERATED 1)
 
 append_srcs_dir(middleware_src_dir  ${middleware_src_path}/v2/sample/common
+                                    ${middleware_src_path}/v2/component/isp/common
                                     ${middleware_src_path}/v2/component/isp/sensor/sg200x/lontium_lt6911
                                     )
 list(APPEND ADD_SRCS        ${middleware_src_dir}
@@ -44,23 +47,11 @@ if(CONFIG_SOPHGO_MIDDLEWARE_C_LIBRARY STREQUAL "musl")
     if(${middleware_version_str} VERSION_EQUAL "0.0.4")
         set(middleware_dynamic_lib_file     ${mmf_lib_dir}/libcvi_ive.so
                                             ${mmf_lib_dir}/libcvi_bin.so
-                                            ${mmf_lib_dir}/libaaccomm2.so
-                                            ${mmf_lib_dir}/libaacdec2.so
-                                            ${mmf_lib_dir}/libaacenc2.so
-                                            ${mmf_lib_dir}/libaacsbrdec2.so
-                                            ${mmf_lib_dir}/libaacsbrenc2.so
                                             ${mmf_lib_dir}/libae.so
                                             ${mmf_lib_dir}/libaf.so
                                             ${mmf_lib_dir}/libawb.so
-                                            ${mmf_lib_dir}/libcvi_audio.so
                                             ${mmf_lib_dir}/libcvi_bin_isp.so
                                             ${mmf_lib_dir}/libcvi_bin.so
-                                            ${mmf_lib_dir}/libcvi_ispd2.so
-                                            ${mmf_lib_dir}/libcvi_RES1.so
-                                            ${mmf_lib_dir}/libcvi_ssp.so
-                                            ${mmf_lib_dir}/libcvi_VoiceEngine.so
-                                            ${mmf_lib_dir}/libcvi_vqe.so
-                                            ${mmf_lib_dir}/libdnvqe.so
                                             ${mmf_lib_dir}/libisp_algo.so
                                             ${mmf_lib_dir}/libisp.so
                                             ${mmf_lib_dir}/libmipi_tx.so
@@ -71,31 +62,16 @@ if(CONFIG_SOPHGO_MIDDLEWARE_C_LIBRARY STREQUAL "musl")
                                             ${mmf_lib_dir}/libvdec.so
                                             ${mmf_lib_dir}/libvenc.so
                                             ${mmf_lib_dir}/libvpu.so
-                                            ${mmf_lib_dir}/libjson-c.so.5
-                                            ${mmf_lib_dir}/libtinyalsa.so
-                                            ${mmf_lib_dir}/3rd/libcli.so
                                             ${mmf_lib_dir}/3rd/libini.so)
     else()
         set(middleware_dynamic_lib_file     ${mmf_lib_dir}/libcvi_ive.so
                                             ${mmf_lib_dir}/libcvi_bin.so
-                                            ${mmf_lib_dir}/libaaccomm2.so
-                                            ${mmf_lib_dir}/libaacdec2.so
-                                            ${mmf_lib_dir}/libaacenc2.so
-                                            ${mmf_lib_dir}/libaacsbrdec2.so
-                                            ${mmf_lib_dir}/libaacsbrenc2.so
                                             ${mmf_lib_dir}/libae.so
                                             ${mmf_lib_dir}/libaf.so
                                             ${mmf_lib_dir}/libawb.so
                                             ${mmf_lib_dir}/libcipher.so
-                                            ${mmf_lib_dir}/libcvi_audio.so
                                             ${mmf_lib_dir}/libcvi_bin_isp.so
                                             ${mmf_lib_dir}/libcvi_bin.so
-                                            ${mmf_lib_dir}/libcvi_ispd2.so
-                                            ${mmf_lib_dir}/libcvi_RES1.so
-                                            ${mmf_lib_dir}/libcvi_ssp.so
-                                            ${mmf_lib_dir}/libcvi_VoiceEngine.so
-                                            ${mmf_lib_dir}/libcvi_vqe.so
-                                            ${mmf_lib_dir}/libdnvqe.so
                                             ${mmf_lib_dir}/libisp_algo.so
                                             ${mmf_lib_dir}/libisp.so
                                             ${mmf_lib_dir}/libmipi_tx.so
@@ -110,10 +86,7 @@ if(CONFIG_SOPHGO_MIDDLEWARE_C_LIBRARY STREQUAL "musl")
                                             ${mmf_lib_dir}/libvenc.so
                                             ${mmf_lib_dir}/libvpu.so
                                             ${mmf_lib_dir}/libz.so
-                                            ${mmf_lib_dir}/libtinyalsa.so
-                                            ${mmf_lib_dir}/3rd/libcli.so
-                                            ${mmf_lib_dir}/3rd/libini.so
-                                            ${mmf_lib_dir}/3rd/libjson-c.so.5)
+                                            ${mmf_lib_dir}/3rd/libini.so)
     endif()
 elseif(CONFIG_SOPHGO_MIDDLEWARE_C_LIBRARY STREQUAL "glibc")
     set(middleware_dynamic_lib_file     ${mmf_lib_dir}/libcvi_vb.so
-- 
2.34.1

